---
lab:
  title: 探索 Azure Database for PostgreSQL
  module: Explore PostgreSQL architecture
---

# 探索 Azure Database for PostgreSQL

在本练习中，你将创建一个 Azure Database for PostgreSQL 灵活服务器并配置备份保持期。

## 开始之前

需要有自己的 Azure 订阅才能完成本练习。 如果还没有 Azure 订阅，可以创建一个 [Azure 免费试用版](https://azure.microsoft.com/free)。

### 创建资源组。

1. 在 Web 浏览器中，导航到 [Azure 门户](https://portal.azure.com)。 使用所有者或参与者帐户登录。
2. 在 Azure 服务下，选择“资源组”，然后选择“+ 创建”。
3. 检查是否显示了正确的订阅，然后输入资源组名称 **rg-PostgreSQL_Flexi**。 选择一个**区域**。
4. 选择“查看 + 创建”。 然后选择“创建”。

### 创建 Azure Database for PostgreSQL 灵活服务器

1. 在“Azure 服务”下，选择“+ 创建资源”。
    1. 在“**搜索市场**”中，键入**`azure database for postgresql flexible server`**，选择 **Azure Database for PostgreSQL 灵活服务器**，然后单击“**创建**”。
1. 在灵活服务器“基本信息”选项卡上，输入每个字段，如下所示：
    1. 订阅 - 你的订阅。
    1. 资源组 - **rg-PostgreSQL_Flexi**。
    1. 服务器名称 - **psql-postgresql-fx9999**（服务器名称必须是全局唯一的，因此请将 9999 替换为四个随机数）。
    1. 区域 - 选择与资源组相同的区域。
    1. PostgreSQL 版本 - 选择“16”。
    1. 工作负载类型 - 开发。
    1. 计算 + 存储 - **可突发，B1ms**。 选择“配置服务器”并检查配置选项。 请勿进行任何更改并关闭边栏选项卡。
    1. 可用性区域 - 无首选项。
    1. 高可用性 - 禁用的。
    1. 身份验证方法 - **仅限 PostgreSQL 身份验证**
    1. 在**管理员用户名**中，输入**`demo`**。
    1. 在**密码**中，输入合适的复杂密码。
    1. 选择“下一步: 网络 >”****。
1. 在灵活服务器“网络”选项卡上，输入每个字段，如下所示：
    1. 连接方法：(o) 公共访问（允许的 IP 地址）和专用终结点
    1. 公共访问，选择 **允许公众使用公共 IP 地址通过互联网访问此资源**
    1. 在“防火墙规则”下，选择“+ 添加当前客户端 IP 地址”，以将当前 IP 地址添加为防火墙规则。 可以选择为此防火墙规则指定一个有意义的名称。
1. 选择“查看 + 创建”。 查看设置，然后选择“**创建**”以创建 Azure Database for PostgreSQL 灵活服务器。 部署完成后，选择“转到资源”以准备下一步。

## 检查服务器参数

1. 在“设置”下，选择“服务器参数”。
1. 在 **搜索以筛选项目 ...** 框中，输入 **`connections`**。 显示与连接相关的服务器参数。 记下 max_connections 的值。 请勿进行任何更改。
1. 在左侧菜单中，选择“概述”，退出“服务器参数”。

## 更改备份保持期

1. 导航到“概述”边栏选项卡，在“设置”下，选择“计算 + 存储”。 此部分显示当前计算层，以及用于升级该层的选项。 它还显示已预配的存储量，以及用于增加存储的选项。
1. “备份”下显示了备份保持期（以天为单位）。 使用滑块栏将备份保持期更改为 14 天。 选择“保存”以保留所做的更改。
1. 完成本练习后，导航到“ **概述** ”边栏选项卡，然后单击“ **停止** ”将停止服务器。
    1. 当服务器处于停止状态时，不会向你收费，但请注意，如果尚未删除服务器，服务器将在七天内重新启动。

## 可选练习 - 配置高可用性服务器

1. 在“Azure 服务”下，选择“+ 创建资源”。
    1. 在“**搜索市场**”中，键入**`azure database for postgresql flexible server`**，选择“**Azure Database for PostgreSQL 灵活服务器**”，然后单击“**创建**”。
1. 在灵活服务器“基本信息”选项卡上，输入每个字段，如下所示：
    1. 订阅 - 你的订阅。
    1. 资源组 - **rg-PostgreSQL_Flexi**。
    1. 服务器名称 - **psql-postgresql-fx8888**（服务器名称必须是全局唯一的，因此请用随机数替换 8888）。
    1. 区域 - 选择与资源组相同的区域。
    1. PostgreSQL 版本 - 选择“16”。
    1. 工作负载类型 - 生产（小型/中型）
    1. 计算 + 存储 - 保留为 **常规用途**。
    1. 可用性区域 - 可以将此项保留为“无首选项”，Azure 将自动为主要服务器和辅助服务器选择可用性区域。 或者，指定要与应用程序归置的可用性区域。
    1. 启用高可用性 - 请检查这一点。 如果选择此选项，请注意估计的成本。
    1. 高可用性模式 - 选择 ** 区域冗余 - 在与主服务器位于同一区域的另一区域内，备用服务器始终可用**
    1. 身份验证方法 - **仅限 PostgreSQL 身份验证**
    1. 在“管理员用户名”中，输入“demo”。
    1. 在**密码**中，输入合适的复杂密码。
    1. 选择“下一步: 网络 >”****。
1. 在灵活服务器“网络”选项卡上，输入每个字段，如下所示：
    1. 连接方法：(o) 公共访问（允许的 IP 地址）和专用终结点
    1. 公共访问，选择 **允许公众使用公共 IP 地址通过互联网访问此资源**
    1. 在“防火墙规则”下，选择“+ 添加当前客户端 IP 地址”，以将当前 IP 地址添加为防火墙规则。 可以选择为此防火墙规则指定一个有意义的名称。
1. 选择“查看 + 创建”。 查看设置，然后选择“**创建**”以创建 Azure Database for PostgreSQL 灵活服务器。 部署完成后，选择“转到资源”以准备下一步。

### 检查新服务器

1. 在“设置”下，选择“高可用性”。 启用高可用性，主要可用性区域为区域 1。
    1. 备用可用性区域已自动分配，并且与主要可用性区域不同，通常为区域 2。

### 强制故障转移

1. 在“高可用性”边栏选项卡上，从顶部菜单中选择“强制故障转移”。 将显示一条消息，选择“确定”。
1. 故障转移过程启动。 故障转移操作成功完成时会显示一条消息。
1. 在“高可用性”边栏选项卡上，可以看到主要区域现在是 2，备用可用性区域为 1。 可能需要刷新浏览器才能看到最新信息。
1. 完成本练习后，请删除此服务器。

## 清理

此实验室练习的服务器会产生费用。 完成练习后，请删除资源组 **rg-PostgreSQL_Flexi**。 这将删除在此实验室练习中部署的服务器和任何其他资源。
